package web;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.Timestamp;
import java.util.ArrayList;
import java.util.List;


public class BoardDAO {

		
	
	public void create(BoardVO boardVo) throws Exception {
		
		String id = boardVo.getId();
		String title = boardVo.getTitle();
		String context = boardVo.getContext();
		//1. connector라이브러리 설정
		Class.forName("com.mysql.jdbc.Driver");
		System.out.println("1. 드라이버/커넥터 설정 성공@@@"); 
		
		//2. db 연결 : 1) ip+port, 2) user+pw, 3)db명(big)
		String url = "jdbc:mysql://localhost:3366/big";
		String user = "root";
		String pass = "1234";
		
		Connection con = DriverManager.getConnection(url, user, pass);

		//3. sql문을 생성
				String sql = "INSERT INTO boards (id, title, rgstdate, context) values(?, ?, now(), ?)";

		PreparedStatement ps = con.prepareStatement(sql);
		ps.setString(1, id);
		ps.setString(2, title);
		ps.setString(3, context);

		
		System.out.println("3. SQL객체 생성 성공.@@@");
				
		//4. 생성한 sql문을 mysql로 보낸다.
		ps.executeUpdate();
		System.out.println("4. SQL문 전송 성공.@@@");
	}
	public List<BoardVO> board_list() throws Exception{
		List<BoardVO> list = new ArrayList<BoardVO>();
		Connection con = null;
		PreparedStatement pstmt = null;
		ResultSet rs = null;
		//1. connector라이브러리 설정
		Class.forName("com.mysql.jdbc.Driver");
		System.out.println("1. 드라이버/커넥터 설정 성공@@@"); 
		
		//2. db 연결 : 1) ip+port, 2) user+pw, 3)db명(big)
		String url = "jdbc:mysql://localhost:3366/big";
		String user = "root";
		String pass = "1234";
		
		con = DriverManager.getConnection(url, user, pass);
		String query = "select * from boards";
		pstmt = con.prepareStatement(query);
		rs = pstmt.executeQuery();
		
			while(rs.next()) {
				BoardVO boardVO = new BoardVO();
				
				boardVO.setIdx(rs.getInt("idx"));
				boardVO.setId(rs.getString("id"));
				boardVO.setTitle(rs.getString("title"));
				boardVO.setRgstdate(rs.getTimestamp("rgstdate"));
				boardVO.setMdfydate(rs.getTimestamp("mdfydate"));
				boardVO.setContext(rs.getString("context"));
				list.add(boardVO);
				}
			
					pstmt.close();
					rs.close();
					con.close();
				
		return list;
	}
	public BoardVO board_view(int m_idx) throws Exception {
		Connection con = null;
		PreparedStatement pstmt = null;
		ResultSet rs = null;
		
		BoardVO boardVO = new BoardVO();
		
		//1. connector라이브러리 설정
				Class.forName("com.mysql.jdbc.Driver");
				System.out.println("1. 드라이버/커넥터 설정 성공@@@"); 
				
				//2. db 연결 : 1) ip+port, 2) user+pw, 3)db명(big)
				String url = "jdbc:mysql://localhost:3366/big";
				String user = "root";
				String pass = "1234";
				
			con = DriverManager.getConnection(url, user, pass);

			// ����� ����
			String query = "SELECT * FROM boards WHERE idx = ?";
			pstmt = con.prepareStatement(query);
			pstmt.setInt(1, m_idx);
			rs = pstmt.executeQuery(); // ������ �����ϰ� ����� ResultSetdp ����
			
			if(rs.next()) {
				boardVO.setIdx(rs.getInt("idx"));
				boardVO.setId(rs.getString("id"));
				boardVO.setTitle(rs.getString("title"));
				boardVO.setRgstdate(rs.getTimestamp("rgstdate"));
				boardVO.setMdfydate(rs.getTimestamp("mdfydate"));
				boardVO.setContext(rs.getString("context"));
			}


		return boardVO;
	}
	
	public void update(BoardVO boardVO) throws Exception {
		Connection con = null;
		PreparedStatement pstmt = null;
		
		
			
			if(BoardVO.getTitle() == null || BoardVO.getTitle().equals("")) {
				// ��й�ȣ ������ ����� ����
				String query = "UPDATE member SET m_name = ?, m_phone = ?,  m_email = ?,"
						+" m_mdfydate = now() WHERE m_idx = ?";
				pstmt = con.prepareStatement(query);
				pstmt.setString(1, memberVO.getM_name());
				pstmt.setString(2, memberVO.getM_phone());
				pstmt.setString(3, memberVO.getM_email());
				pstmt.setInt(4, memberVO.getM_idx());
				
				pstmt.executeUpdate();
			}
			else {
				// ��й�ȣ ������ ����� ����
				String query = "UPDATE member SET m_pw = ?, m_name = ?, m_phone = ?,  m_email = ?,"
						+" m_mdfydate = now() WHERE m_idx = ?";
				pstmt = con.prepareStatement(query);
				pstmt.setString(1, memberVO.getM_pw());
				pstmt.setString(2, memberVO.getM_name());
				pstmt.setString(3, memberVO.getM_phone());
				pstmt.setString(4, memberVO.getM_email());
				pstmt.setInt(5, memberVO.getM_idx());
				
				pstmt.executeUpdate();
			}
		}
}
